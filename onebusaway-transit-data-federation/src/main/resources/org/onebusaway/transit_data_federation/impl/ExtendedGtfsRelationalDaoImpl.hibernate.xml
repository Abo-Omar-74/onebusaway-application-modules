<?xml version="1.0"?>
<!--

    Copyright (C) 2011 Brian Ferris <bdferris@onebusaway.org>

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <query name="latLonBoundsForStopsByAgencyId" read-only="true">
        SELECT stop.id.agencyId, min(stop.lat), min(stop.lon), max(stop.lat), max(stop.lon)
        FROM Stop stop
        GROUP BY stop.id.agencyId
    </query>
    <query name="serviceIdsForAgencyId" read-only="true">
        SELECT stop.id FROM Stop stop WHERE stop.id.agencyId = :agencyId
    </query>
    <query name="stopIdsForAgencyId" read-only="true">
        SELECT stop.id FROM Stop stop WHERE stop.id.agencyId = :agencyId
    </query>
    <query name="routeIdsForAgencyId" read-only="true">
        SELECT route.id FROM RouteCollection route WHERE route.id.agencyId = :agencyId
    </query>
    <query name="getRoutesForStop" read-only="true">
        SELECT route FROM
        Route route,
        Trip trip,
        StopTime stopTime
        WHERE
        stopTime.stop = :stop
        AND stopTime.trip = trip
        AND trip.route = route
        GROUP BY route.id.agencyId, route.id.id
    </query>
    <query name="stopTimesByBlockId" read-only="true">
        SELECT st
        FROM StopTime st
        WHERE st.trip.id.agencyId = :agencyId AND
        st.trip.blockId = :blockId
    </query>
    <query name="stopTimesByTripIds" read-only="true">
        SELECT st FROM StopTime st WHERE st.trip.id IN (:tripIds)
    </query>
    <query name="shapePointIdsForRoutes" read-only="true">
        SELECT trip.shapeId
          FROM Trip trip
          WHERE trip.route IN (:routes)
          AND trip.shapeId IS NOT NULL
          GROUP BY trip.shapeId.agencyId, trip.shapeId.id
    </query>
</hibernate-mapping>
